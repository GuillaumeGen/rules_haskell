load("@rules_haskell//haskell:c2hs.bzl", "c2hs_library")
load(
    "@rules_haskell//haskell:defs.bzl",
    "haskell_library",
    "haskell_binary",
)

package(default_testonly = 1)

c2hs_library(
    name = "foo",
    srcs = ["src/Foo/Foo.chs"],
    src_strip_prefix = "src",
    tags = [
        "requires_c2hs",
        "requires_zlib",
    ],
    deps = ["@zlib.dev//:zlib"],
)

c2hs_library(
    name = "bar",
    srcs = ["Bar.chs"],
    tags = ["requires_c2hs"],
    deps = [":foo"],
)

cc_library(
    name = "code-c",
    srcs = ["c/src/code.c"],
    hdrs = ["c/include/code.h"],
    strip_include_prefix = "c/include",
)

c2hs_library(
    name = "code",
    srcs = ["Code.chs"],
    tags = ["requires_c2hs"],
    deps = [":code-c"],
)


haskell_library(
    name = "c2hs",
    srcs = [
        ":bar",
        ":foo",
        "@c2hs_repo//:baz",
        ":code",
    ],
    tags = ["requires_c2hs"],
    deps = ["//tests/hackage:base"],
)

haskell_binary(
    name = "c2hs-bin",
    srcs = [
        "bin/Main.hs",
    ],
    deps = [
        ":c2hs",
        "//tests/hackage:base",
    ],
)
