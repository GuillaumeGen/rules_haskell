"""
Minimal reproduction of https://github.com/tweag/rules_haskell/issues/1111
"""

load("//haskell:defs.bzl", "haskell_doc", "haskell_library")
load(
    "//haskell:protobuf.bzl",
    "haskell_proto_library",
    "haskell_proto_toolchain",
)

proto_library(
    name = "foo",
    srcs = ["foo.proto"],
    deps = ["@com_google_protobuf//:descriptor_proto"],
    tags = ["requires_proto"],
)

haskell_proto_library(
    name = "foo_haskell",
    deps = [
        ":foo",
    ],
    tags = ["requires_proto"],
)

haskell_library(
    name = "hs-lib",
    srcs = ["Bar.hs"],
    deps = [
        ":foo_haskell",
        "//tests/hackage:base",
        "@stackage//:proto-lens",
    ],
    tags = ["requires_proto"],
    visibility = ["//visibility:public"],
)
